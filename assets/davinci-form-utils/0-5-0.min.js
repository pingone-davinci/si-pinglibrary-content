let DEFAULT_PASSWORD_POPUP_TITLE="Password Requirements",PASSWORD_ERROR_MESSAGE="Password does not meet requirements",FORM_TYPE_UPDATE_PASSWORD="UPDATE_PASSWORD",VALID_TAGS=["INPUT","SELECT","TEXTAREA"],VALID_TYPES=["text","email","password","number","checkbox","radio"];class DaVinciFormUtils{static makePasswordToggle(e){let s;if("string"==typeof e){if(!(s=document.getElementById(e)))return void console.warn(`Container with ID '${e}' not found.`)}else{if(!(e instanceof HTMLElement))return void console.warn("Invalid parameter. Expected a string ID or an HTMLElement.");if(!(s=e))return void console.warn("Provided element is null or undefined.")}let r=s.querySelector("input[type='password']");if(r){let a=document.createElement("button");a.setAttribute("type","button"),a.setAttribute("aria-label","Show/Hide Password"),a.className="mdi mdi-eye-off-outline",Object.assign(a.style,{position:"absolute",right:"10px",zIndex:"2",background:"transparent",border:"none",outline:"none"}),s.style.position="relative",s.appendChild(a);a.addEventListener("click",()=>{var e="password"===r.type;r.type=e?"text":"password",a.classList.toggle("mdi-eye-outline",e),a.classList.toggle("mdi-eye-off-outline",!e),r.focus()});let e=()=>{var e=r.getBoundingClientRect(),t=s.getBoundingClientRect(),i=(e.height-a.offsetHeight)/2;a.style.top=e.top-t.top+i+2+"px"};e(),new MutationObserver(()=>{e()}).observe(r,{attributes:!0,childList:!0,subtree:!0}),window.addEventListener("resize",e)}else console.warn("Password input field not found within container.")}static addRequiredFieldIndicators(e=null){let t;if(e){var i=document.getElementById(e);if(!i)return void console.warn(`Form with ID '${e}' not found.`);t=i.querySelectorAll("input[required], textarea[required], select[required]")}else t=document.querySelectorAll("input[required], textarea[required], select[required]");t.forEach(e=>{var t,e=e.labels?e.labels[0]:null;e&&!e.querySelector(".text-danger")&&((t=document.createElement("span")).textContent=" *",t.classList.add("text-danger"),e.appendChild(t))})}static addDaVinciFormValidation({formId:d,passwordFieldContainerId:c,confirmPasswordFieldContainerId:u,passwordPolicy:m=null,validationSuccessClickHandler:p=null,invalidFieldBorderColor:g=null,passwordErrorMessage:y=PASSWORD_ERROR_MESSAGE,addRequiredFieldIndicators:h=!0,setFocusOnFirstField:f=!0,setFocusOnFirstError:v=!0,enablePasswordToggle:E=!0,useDefaultStyles:P=!0,passwordPopupTitle:w=DEFAULT_PASSWORD_POPUP_TITLE,formType:b=FORM_TYPE_UPDATE_PASSWORD,delayValidationUntilSubmit:S=!1,disableSubmitButtonUntilValid:A=!1}){let x=document.getElementById(d),L,R=!S;if(x)if(L=document.querySelector('button[data-skbuttontype="form-submit"][type="submit"]')){A&&(L.disabled=!0),x.setAttribute("novalidate","novalidate");let e,r,t,l;if(b===FORM_TYPE_UPDATE_PASSWORD){if(e=document.getElementById(c),r=e.querySelector('input[type="password"]'),t=document.getElementById(u),l=t.querySelector('input[type="password"]'),!r||!l)return void console.error("Password or confirm password field not found.");if(!m)return void console.error("Password policy is required for update password forms.")}else b!==FORM_TYPE_UPDATE_PASSWORD&&c&&(e=document.getElementById(c),r=e.querySelector('input[type="password"]'));if(b===FORM_TYPE_UPDATE_PASSWORD){if(!e)return void console.error(`Password container with ID "${c}" not found.`);if(!t)return void console.error(`Confirm password container with ID "${u}" not found.`);if(m&&"string"==typeof m)try{m=JSON.parse(m)}catch(e){console.error("Invalid JSON string provided for passwordPolicy."),m=null}}h&&DaVinciFormUtils.addRequiredFieldIndicators(d),f&&(S=x.querySelector("input, select, textarea"))&&S.focus(),E&&(e&&DaVinciFormUtils.makePasswordToggle(e),t)&&DaVinciFormUtils.makePasswordToggle(t);let i=e=>{var t=document.getElementById("passwordPopup"),e=e.getBoundingClientRect();t.style.top=e.top+window.scrollY-50+"px",t.style.left=e.right+window.scrollX+15+"px",t.classList.add("visible"),t.style.display="block"},o=e=>{var t,i,a,s;m.length&&void 0!==m.length.min&&void 0!==m.length.max&&(s=e.length>=m.length.min&&e.length<=m.length.max,(a=document.getElementById("policy-length").querySelector("i")).classList.toggle("mdi-check-circle",s),a.classList.toggle("mdi-alert-circle",!s),document.getElementById("policy-length").classList.toggle("text-success",s),document.getElementById("policy-length").classList.toggle("text-danger",!s));for([t,i]of Object.entries(m.minCharacters)){var r=t.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),r=new RegExp(`[${r}]`,"g"),r=(e.match(r)||[]).length>=i,l=document.getElementById("policy-"+t).querySelector("i");l.classList.toggle("mdi-check-circle",r),l.classList.toggle("mdi-alert-circle",!r),document.getElementById("policy-"+t).classList.toggle("text-success",r),document.getElementById("policy-"+t).classList.toggle("text-danger",!r)}m.minUniqueCharacters&&(a=new Set(e).size>=m.minUniqueCharacters,(s=document.getElementById("policy-unique").querySelector("i")).classList.toggle("mdi-check-circle",a),s.classList.toggle("mdi-alert-circle",!a),document.getElementById("policy-unique").classList.toggle("text-success",a),document.getElementById("policy-unique").classList.toggle("text-danger",!a)),m.maxRepeatedCharacters&&(s=e.match(/(.)\1*/g)||[],a=Math.max(...s.map(e=>e.length))<=m.maxRepeatedCharacters&&e.length>m.maxRepeatedCharacters,(s=document.getElementById("policy-repeat").querySelector("i")).classList.toggle("mdi-check-circle",a),s.classList.toggle("mdi-alert-circle",!a),document.getElementById("policy-repeat").classList.toggle("text-success",a),document.getElementById("policy-repeat").classList.toggle("text-danger",!a))};if(b===FORM_TYPE_UPDATE_PASSWORD){{c=w;var D,T,_,I,u=document.createElement("div");u.id="passwordPopup",u.classList.add("password-popup","text-muted");let e=`<p class="text-center fw-bold mt-3">${c}</p><ul class="list-unstyled">`;m.length&&void 0!==m.length.min&&void 0!==m.length.max&&(e+=`<li id="policy-length"><i class="mdi mdi-alert-circle me-2"></i> Be between ${m.length.min} and ${m.length.max} characters</li>`),m.minUniqueCharacters&&(e+=`<li id="policy-unique"><i class="mdi mdi-alert-circle me-2"></i> Have at least ${m.minUniqueCharacters} unique characters</li>`),m.maxRepeatedCharacters&&(e+=`<li id="policy-repeat"><i class="mdi mdi-alert-circle me-2"></i> No more than ${m.maxRepeatedCharacters} repeated characters</li>`);for([D,T]of Object.entries(m.minCharacters)){_=D,I=T,void 0,C=(e,t)=>1===t?e:e+"s";var C="0123456789"===_?I+" "+C("number",I):"ABCDEFGHIJKLMNOPQRSTUVWXYZ"===_?I+" "+C("uppercase character",I):"abcdefghijklmnopqrstuvwxyz"===_?I+" "+C("lowercase character",I):"~!@#$%^&*()-_=+[]{}|;:,.<>/?"===_?I+" "+C("special character",I):`${I} ${C("character",I)} from the set: "${_}"`;e+=`<li id="policy-${D}"><i class="mdi mdi-alert-circle me-2"></i> ${C}</li>`}e+="</ul>",u.innerHTML=e,document.body.appendChild(u)}!P||document.getElementById("default-password-styles")||((h=document.createElement("style")).id="default-password-styles",h.innerHTML=`
      .password-popup {
        position: absolute;
        width: 300px;
        opacity: 0;
        z-index: 1000;
        background-color: #FFFFFF !important;
        border: 1px solid #CCCCCC !important;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        padding: 5px !important;
        border-radius: 4px;
        font-size: 0.875rem;
        transition: opacity 0.3s ease, transform 0.3s ease;
      }

      .password-popup.visible {
        opacity: 1;
      }

      .password-popup ul {
        padding-left: 15px !important;
        list-style-type: none !important;
      }

      .password-popup li {
        list-style: none !important;
        margin-bottom: 8px !important;
      }
    `,document.head.appendChild(h))}let a=(t,e=!1)=>{let i="";var a;if(t===r&&m?(a=t.value,s=DaVinciFormUtils.validatePasswordAgainstPolicy(a,m,y),o(a),s.isValid||(i=s.message)):t===l?(a=DaVinciFormUtils.verifyPasswordsMatch(r.value,t.value)).isValid||(i=a.message):i=t.validity.valueMissing?t.getAttribute("data-required-message")||"This field is required.":t.validity.typeMismatch?t.getAttribute("data-type-mismatch-message")||"Please enter a valid value.":t.validity.patternMismatch?t.getAttribute("data-pattern-mismatch-message")||"Please follow the required pattern.":t.validity.tooShort?t.getAttribute("data-too-short-message")||`Minimum length is ${t.minLength} characters.`:t.validity.tooLong?t.getAttribute("data-too-long-message")||`Maximum length is ${t.maxLength} characters.`:"email"!==t.type||/^[\w.%+-]+@[\w.-]+\.[a-zA-Z]{2,}$/.test(t.value)?"":t.getAttribute("data-email-invalid-message")||"Please enter a valid email address.",e||t===l||t.hasAttribute("data-has-been-blurred")){t.setCustomValidity(i);var s=t.parentNode;let e=s.querySelector(".custom-invalid-feedback");e||((e=document.createElement("div")).classList.add("custom-invalid-feedback","text-danger","mt-1"),e.setAttribute("aria-live","assertive"),s.appendChild(e)),e.textContent=i,e.classList.toggle("show",!!i),g&&!t.checkValidity()?t.style.borderColor=g:t.style.borderColor=""}else t.setCustomValidity("")},s=e=>{let t=!1;e.addEventListener("input",()=>{(R||b===FORM_TYPE_UPDATE_PASSWORD&&(e===r||e===l))&&(e===r&&b===FORM_TYPE_UPDATE_PASSWORD&&m&&i(e),a(e),t&&(a(e,!0),t=e.checkValidity()?(e.classList.remove("custom-invalid"),!1):(e.classList.add("custom-invalid"),!0)),e===r)&&l&&l.value&&a(l,!0),A&&L&&(L.disabled=!x.checkValidity())}),e.addEventListener("blur",()=>{if(e.setAttribute("data-has-been-blurred","true"),(R||b===FORM_TYPE_UPDATE_PASSWORD&&(e===r||e===l))&&(a(e,!0),t=e.checkValidity()?(e.classList.remove("custom-invalid"),!1):(e.classList.add("custom-invalid"),!0),e===r)&&b===FORM_TYPE_UPDATE_PASSWORD&&m){let e=document.getElementById("passwordPopup");e.classList.remove("visible"),setTimeout(()=>{e.style.display="none"},300)}}),b===FORM_TYPE_UPDATE_PASSWORD&&m&&e.addEventListener("focus",()=>{e===r&&i(e)})},n=e=>VALID_TAGS.includes(e.tagName)&&("INPUT"!==e.tagName||VALID_TYPES.includes(e.type));Array.from(x.elements).forEach(e=>{n(e)&&e.willValidate&&s(e)}),L.addEventListener("click",function(e){let t=!0,i=[];Array.from(x.elements).forEach(e=>{n(e)&&(e.setAttribute("data-has-been-blurred","true"),a(e,!0),e.checkValidity()?e.classList.remove("custom-invalid"):(e.classList.add("custom-invalid"),i.push(e),t=!1))}),t?(console.log("Is all valid: true...attempting to continue click"),e.target.click(),p&&"function"==typeof p&&p("success")):(e.preventDefault(),e.stopPropagation(),0<i.length&&v&&i[0].focus()),R=!0})}else console.error("Existing submit button not found.");else console.error(`Form with ID "${d}" not found.`)}static validatePasswordAgainstPolicy(e,t,i=PASSWORD_ERROR_MESSAGE){if(!e)return{isValid:!1,message:"Password is not provided"};if(!t)return{isValid:!1,message:"Policy is not provided"};var a,s;if(!(e.length>=t.length.min&&e.length<=t.length.max))return{isValid:!1,message:i};for([a,s]of Object.entries(t.minCharacters)){var r=a.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),r=new RegExp(`[${r}]`,"g");if((e.match(r)||[]).length<s)return{isValid:!1,message:i}}if(t.minUniqueCharacters&&new Set(e).size<t.minUniqueCharacters)return{isValid:!1,message:i};if(t.maxRepeatedCharacters){var l=e.match(/(.)\1*/g)||[];if(Math.max(...l.map(e=>e.length))>t.maxRepeatedCharacters)return{isValid:!1,message:i}}return{isValid:!0,message:""}}static verifyPasswordsMatch(e,t){return e?t?e!==t?{isValid:!1,message:"Passwords do not match"}:{isValid:!0,message:""}:{isValid:!1,message:"Confirm password is not provided"}:{isValid:!1,message:"Password is not provided"}}static createChangeObserver(e,i,t={childList:!0,characterData:!0,subtree:!0}){var a=document.getElementById(e);if(!a)return console.warn(`Element with ID '${e}' not found.`),()=>{};let s=new MutationObserver(e=>{for(var t of e)("characterData"===t.type||"childList"===t.type&&0<t.addedNodes.length)&&i(t)});return s.observe(a,t),()=>s.disconnect()}static textToBoolean(e){if("boolean"==typeof e)return e;if("string"==typeof e){e=e.toLowerCase();if("true"===e)return!0;if("false"===e);}return!1}}